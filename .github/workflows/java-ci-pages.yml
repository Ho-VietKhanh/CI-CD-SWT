name: Java CI + Deploy GitHub Pages

        on:
          push:
            branches: [ main ]
          pull_request:
            branches: [ main ]
          workflow_dispatch:

        permissions:
          contents: read
          pages: write
          id-token: write

        concurrency:
          group: "pages"
          cancel-in-progress: false

        jobs:
          build:
            runs-on: ubuntu-latest
            steps:
              - name: Checkout source code
                uses: actions/checkout@v4

              - name: Set up JDK 17
                uses: actions/setup-java@v4
                with:
                  java-version: '17'
                  distribution: 'temurin'

              - name: Cache Maven dependencies
                uses: actions/cache@v3
                with:
                  path: ~/.m2
                  key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}

              - name: Build with Maven
                run: mvn -B clean package --file pom.xml

              - name: Run tests
                run: mvn test

              # Tạo thư mục chứa static files cho Pages
              - name: Create Pages content
                run: |
                  mkdir -p pages
                  # Copy file HTML/CSS/JS cần thiết vào thư mục pages
                  cp index.html pages/ 2>/dev/null || echo "<!DOCTYPE html><html><body><h1>CI/CD Success!</h1></body></html>" > pages/index.html

              - name: Upload Pages artifact
                uses: actions/upload-pages-artifact@v3
                with:
                  path: pages

          deploy:
            environment:
              name: github-pages
              url: ${{ steps.deployment.outputs.page_url }}
            runs-on: ubuntu-latest
            needs: build
            if: github.ref == 'refs/heads/main'  # chỉ deploy khi push vào main
            steps:
              - name: Deploy to GitHub Pages
                id: deployment
                uses: actions/deploy-pages@v4